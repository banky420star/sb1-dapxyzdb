#!/usr/bin/env python3
"""
Simple Network Visualization for AI Trading System
Creates a text-based network diagram showing component relationships
"""

import json
from collections import defaultdict, Counter

def load_network_data():
    """Load the network data generated by DeepGraph analysis"""
    try:
        with open('network_data.json', 'r') as f:
            return json.load(f)
    except FileNotFoundError:
        print("âŒ network_data.json not found. Run deepgraph_analysis.py first.")
        return None

def create_component_network():
    """Create a simplified component-level network view"""
    data = load_network_data()
    if not data:
        return
    
    print("ğŸŒ AI Trading System - Component Network Visualization")
    print("=" * 70)
    
    # Group nodes by component/type
    components = defaultdict(list)
    
    for node in data['nodes']:
        node_id = node['id']
        node_type = node['type']
        component = node['attributes'].get('component', '')
        
        if component:
            components[component].append((node_id, node_type))
        else:
            # Group by directory or type
            if '/' in node_id:
                main_dir = node_id.split('/')[0]
                components[main_dir].append((node_id, node_type))
            else:
                components['root'].append((node_id, node_type))
    
    # Create ASCII network diagram
    print("\nğŸ—ï¸  SYSTEM ARCHITECTURE DIAGRAM")
    print("â”€" * 50)
    
    # Core components
    core_components = ['ml', 'trading', 'risk', 'data', 'api', 'ui']
    support_components = ['monitoring', 'server', 'config', 'scripts']
    
    print("         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
    print("         â”‚   FRONTEND UI   â”‚")
    print("         â”‚  (React/TS)     â”‚")
    print("         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜")
    print("                   â”‚")
    print("         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”")
    print("         â”‚   API GATEWAY   â”‚")
    print("         â”‚ (Express.js)    â”‚")
    print("         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜")
    print("                   â”‚")
    print("    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
    print("    â”‚              â”‚              â”‚")
    print("â”Œâ”€â”€â”€â–¼â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”")
    print("â”‚  ML   â”‚â—„â”€â”€â–ºâ”‚ TRADING   â”‚â—„â”€â–ºâ”‚  RISK   â”‚")
    print("â”‚ENGINE â”‚    â”‚  ENGINE   â”‚   â”‚MANAGER  â”‚")
    print("â””â”€â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜")
    print("    â”‚              â”‚              â”‚")
    print("    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
    print("                   â”‚")
    print("         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”")
    print("         â”‚  DATA MANAGER   â”‚")
    print("         â”‚ (TimescaleDB)   â”‚")
    print("         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜")
    print("                   â”‚")
    print("         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”")
    print("         â”‚   MONITORING    â”‚")
    print("         â”‚(Prometheus/Loki)â”‚")
    print("         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
    
    # Component details
    print(f"\nğŸ“Š COMPONENT BREAKDOWN:")
    print("â”€" * 30)
    
    component_stats = {}
    for comp_name, nodes in components.items():
        if comp_name in ['ml', 'trading', 'risk', 'data', 'server', 'src']:
            file_types = Counter(node[1] for node in nodes)
            component_stats[comp_name] = {
                'total': len(nodes),
                'types': dict(file_types)
            }
            
            print(f"\nğŸ”§ {comp_name.upper()}: {len(nodes)} files")
            for file_type, count in file_types.most_common(3):
                print(f"   â””â”€â”€ {file_type}: {count}")
    
    # Connection analysis
    print(f"\nğŸ”— CONNECTION ANALYSIS:")
    print("â”€" * 25)
    
    edge_types = Counter(edge['type'] for edge in data['edges'])
    total_connections = len(data['edges'])
    
    print(f"Total connections: {total_connections}")
    for edge_type, count in edge_types.items():
        percentage = (count / total_connections) * 100
        print(f"  {edge_type}: {count} ({percentage:.1f}%)")
    
    # Network health metrics
    print(f"\nğŸ’š NETWORK HEALTH:")
    print("â”€" * 20)
    
    total_nodes = len(data['nodes'])
    density = (total_connections / (total_nodes * (total_nodes - 1) / 2)) * 100
    
    print(f"âœ… Modularity: {'HIGH' if density < 5 else 'MEDIUM' if density < 15 else 'LOW'}")
    print(f"âœ… Separation: {'EXCELLENT' if len(components) > 8 else 'GOOD'}")
    print(f"âœ… Documentation: {'COMPREHENSIVE' if any('documentation' in str(node) for node in data['nodes']) else 'BASIC'}")
    print(f"âœ… Testing: {'PRESENT' if 'tests' in components else 'MISSING'}")
    
    return component_stats

def show_data_flow():
    """Show the data flow through the system"""
    print(f"\nğŸ”„ DATA FLOW VISUALIZATION:")
    print("=" * 40)
    
    flow_steps = [
        "1. Market Data Sources",
        "   â”œâ”€â”€ Alpha Vantage API",
        "   â”œâ”€â”€ Bybit Exchange",
        "   â””â”€â”€ MT5 Platform",
        "",
        "2. Data Ingestion Layer",
        "   â”œâ”€â”€ Real-time WebSocket feeds",
        "   â”œâ”€â”€ REST API polling", 
        "   â””â”€â”€ ZeroMQ MT5 bridge",
        "",
        "3. Data Processing Pipeline",
        "   â”œâ”€â”€ Technical indicators calculation",
        "   â”œâ”€â”€ Feature engineering",
        "   â””â”€â”€ Data normalization",
        "",
        "4. ML/AI Engine",
        "   â”œâ”€â”€ LSTM price prediction",
        "   â”œâ”€â”€ Random Forest classification",
        "   â”œâ”€â”€ DDQN reinforcement learning",
        "   â””â”€â”€ Ensemble decision making",
        "",
        "5. Trading Engine",
        "   â”œâ”€â”€ Signal generation",
        "   â”œâ”€â”€ Order management",
        "   â”œâ”€â”€ Position tracking",
        "   â””â”€â”€ Execution routing",
        "",
        "6. Risk Management",
        "   â”œâ”€â”€ Position sizing",
        "   â”œâ”€â”€ Stop-loss enforcement",
        "   â”œâ”€â”€ Drawdown monitoring",
        "   â””â”€â”€ Correlation analysis",
        "",
        "7. Storage & Monitoring",
        "   â”œâ”€â”€ TimescaleDB storage",
        "   â”œâ”€â”€ Performance metrics",
        "   â”œâ”€â”€ Logging & alerts",
        "   â””â”€â”€ Dashboard updates"
    ]
    
    for step in flow_steps:
        print(step)

def main():
    """Main visualization function"""
    component_stats = create_component_network()
    show_data_flow()
    
    print(f"\nğŸ¯ SUMMARY:")
    print("=" * 15)
    print("This AI Trading System demonstrates:")
    print("â€¢ Sophisticated multi-layer architecture")
    print("â€¢ Comprehensive ML/AI integration")
    print("â€¢ Production-grade monitoring & deployment")
    print("â€¢ Professional risk management")
    print("â€¢ Real-time autonomous operation")
    
    print(f"\nğŸ“ˆ This represents a state-of-the-art algorithmic trading platform")
    print(f"   suitable for professional trading operations.")

if __name__ == "__main__":
    main()